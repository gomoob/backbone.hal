!function(a,b){if("function"==typeof define&&define.amd)define(["backbone","underscore","backbone.paginator"],function(c,d,e){return c.PageableCollection=e,a.Hal=b(a,c,d)});else if("undefined"!=typeof exports){var c=require("backbone"),d=require("underscore");c.PageableCollection=require("backbone.paginator"),module.exports=b(a,c,d)}else a.Hal=b(a,a.Backbone,a._)}(this,function(a,b,c){"use strict";var d={};return d.Embedded=b.Model.extend({set:function(a,e,f){var g;return null===a?this:("object"==typeof a?(g=a,f=e):(g={})[a]=e,c.map(g,function(a,e){if(a instanceof d.Model||a instanceof d.Collection)b.Model.prototype.set.call(this,e,a);else if(c.isArray(a)){for(var f=[],g=0;g<a.length;++g)f.push(a[g]instanceof d.Model||a[g]instanceof d.Collection?a[g]:new d.Model(a[g]));b.Model.prototype.set.call(this,e,f)}else if(c.isObject(a))b.Model.prototype.set.call(this,e,new d.Model(a));else{if(!c.isNull(a)&&!c.isUndefined(a))throw new Error("Invalid embedded resource identified by 'rel'='"+e+"' !");b.Model.prototype.set.call(this,e,a)}},this),this)},toJSON:function(a){{var b={},e=a||{};e.contentType||d.contentType||"application/json"}for(var f in this.attributes){var g=this.attributes[f];if(c.isArray(g)){b[f]=[];for(var h=0;h<g.length;++h)b[f].push(g[h].toJSON(e))}else b[f]=this.attributes[f].toJSON(e)}return b}}),d.Link=b.Model.extend({_templated:void 0,createModel:function(){return new d.Model({id:parseInt(this.get("href").split("/").pop(),10)})},initialize:function(a){if(!c.isObject(a)||!c.isString(a.href))throw new Error('Missing required property "href" !');this._templated=this.get("templated"),this.attributes.templated=this._templated===!0,this.on("change:templated",function(a,b){this._templated=b},this)},getDeprecation:function(){return this.get("deprecation")},getName:function(){return this.get("name")},getHref:function(){return this.get("href")},getHreflang:function(){return this.get("hreflang")},getProfile:function(){return this.get("profile")},getTitle:function(){return this.get("title")},getType:function(){return this.get("type")},isArray:function(){return!1},isTemplated:function(){return this.get("templated")},setDeprecation:function(a){this.set("deprecation",a)},setHref:function(a){this.set("href",a)},setHreflang:function(a){this.set("hreflang",a)},setName:function(a){this.set("name",a)},setProfile:function(a){this.set("profile",a)},setTemplated:function(a){this.set("templated",a)},setTitle:function(a){this.set("title",a)},setType:function(a){this.set("type",a)},toJSON:function(){return c.isUndefined(this._templated)&&delete this.attributes.templated,b.Model.prototype.toJSON.apply(this)}}),d.LinkArray=b.Collection.extend({model:d.Link,initialize:function(a,d){if(!c.isArray(a)||0===a.length)throw new Error("A LinkArray MUST BE created with at least one link model !");return b.Collection.prototype.initialize.apply(this,a,d)},isArray:function(){return!0}}),d.Links=b.Model.extend({getSelf:function(){return this.get("self")},hasSelf:function(){var a=this.getSelf();return!(c.isNull(a)||c.isUndefined(a))},set:function(a,e,f){var g;return null===a?this:("object"==typeof a?(g=a,f=e):(g={})[a]=e,c.map(g,function(a,e){if(a instanceof d.Link)b.Model.prototype.set.call(this,e,a);else if(c.isArray(a))b.Model.prototype.set.call(this,e,new d.LinkArray(a));else{if(!c.isObject(a))throw new Error("Invalid link identified by 'rel'='"+e+"' !");b.Model.prototype.set.call(this,e,new d.Link(a))}},this),this)},toJSON:function(a){{var b={},c=a||{};c.contentType||d.contentType||"application/json"}for(var e in this.attributes)b[e]=this.attributes[e].toJSON(c);return b}}),d.Model=b.Model.extend({_links:null,_embedded:null,clone:function(){return new this.constructor(this.toJSON({contentType:"application/hal+json"}))},hasEmbedded:function(a){return this._embedded.has(a)},hasLink:function(a){return this._links.has(a)},getEmbedded:function(a){var b=this._embedded;return c.isString(a)&&(b=b.get(a)),b},getLink:function(a){return this.getLinks().get(a)},getLinks:function(){return this._links},setEmbedded:function(a,b){this.getEmbedded().set(a,b)},unsetEmbedded:function(a,b){this.getEmbedded().unset(a,b)},initialize:function(){this._links=this._links||new d.Links,this._embedded=this._embedded||new d.Embedded},toJSON:function(a){var b=c.isEmpty(this.getLinks().attributes),e=c.isEmpty(this.getEmbedded().attributes),f=null,g=a||{},h=g.contentType||d.contentType||"application/json";return"application/json"===h?f=c.extend({},this.attributes,this.getEmbedded().toJSON(g)):"application/hal+json"===h&&(f=b&&e?c.clone(this.attributes):b?c.extend({},this.attributes,{_embedded:this.getEmbedded().toJSON(g)}):e?c.extend({},this.attributes,{_links:this.getLinks().toJSON(g)}):c.extend(c.clone(this.attributes),{_embedded:this.getEmbedded().toJSON(g),_links:this.getLinks().toJSON(g)})),f},set:function(a,e,f){var g;return null===a?this:("object"==typeof a?(g=a,f=e):(g={})[a]=e,g._links&&(this._links?this._links.set(g._links):this._links=new d.Links(g._links)),g._embedded&&(this._embedded?this._embedded.set(g._embedded):this._embedded=new d.Embedded(g._embedded)),g=c.omit(g,"_links","_embedded"),b.Model.prototype.set.call(this,g,e,f))},url:function(){if(this.getLinks().hasSelf())return this.getLinks().getSelf().getHref();var a=c.result(this,"urlRoot")||c.result(this.collection,"url"),b=c.result(d,"urlRoot"),e=c.result(this,"urlMiddle");if(!a&&c.isString(b)&&(a=b,c.isString(e)&&(a=a.replace(/([^\/])$/,"$1/")+e)),!a)throw new Error('A "url" property or function must be specified');if(this.isNew())return a;var f=this.id||this.attributes[this.idAttribute];return a.replace(/([^\/])$/,"$1/")+encodeURIComponent(f)}}),function(){function a(a,b){if(!c.isNumber(a)||c.isNaN(a)||!c.isFinite(a)||~~a!==a)throw new TypeError("`"+b+"` must be a finite integer");return a}d.Collection=b.PageableCollection.extend({mode:"infinite",model:d.Model,queryParams:{currentPage:"page",pageSize:"page_size",totalPages:null,totalRecords:null},parseParams:{currentPage:"page",pageSize:"page_size",totalPages:"total_pages",totalRecords:"total_entries",pageProperty:null},state:{firstPage:1,pageSize:12},rel:null,constructor:function(a,d){b.PageableCollection.prototype.constructor.apply(this,arguments),d=d||{};var f=c.extend({},e.parseParams,this.parseParams,d.parseParams);this.parseParams=f},parseLinks:function(a){if(!a._links.first&&"infinite"===this.mode&&0!==a.total_items)throw new Error("You are using the 'infinite' mode and the server did not returned a 'first' link attached to the HAL Collection. Check if the collection URL is correct and the payload is well formed. If your collection is not paginated you could use the 'server' mode instead.");if(!a._links.last&&"infinite"===this.mode&&0!==a.total_items)throw new Error("You are using the 'infinite' mode and the server did not returned a 'last' link attached to the HAL Collection. Check if the collection URL is correct and the payload is well formed. If your collection is not paginated you could use the 'server' mode instead.");var b={},c=this._getPageEntity(a);return 0!==c[parseParams.totalRecords]&&(b.first=a._links.first.href,b.last=a._links.last.href),a._links.next&&(b.next=a._links.next.href),a._links.prev&&(b.prev=a._links.prev.href),b},parseRecords:function(a){if(!this.rel)throw new Error("A 'rel' parameter is required !");return a._embedded[this.rel]},_getPageEntity:function(a){return this.parseParams.pageProperty&&c.has(a,this.parseParams.pageProperty)?a[this.parseParams.pageProperty]:a},parseState:function(a){var b=this._getPageEntity(a),d=this.parseParams,e={currentPage:b[d.currentPage],pageSize:b[d.pageSize]};return d.totalRecords&&c.has(b,d.totalRecords)&&(e.totalRecords=b[d.totalRecords]),d.totalPages&&c.has(b,d.totalPages)&&(e.totalPages=b[d.totalPages]),e},getPage:function(b,d){var e=this.mode,f=this.fullCollection;d=d||{fetch:!1};var g=this.state,h=g.firstPage,i=g.currentPage,j=g.lastPage,k=g.pageSize,l=b;switch(b){case"first":l=h;break;case"prev":l=i-1;break;case"next":l=i+1;break;case"last":l=j;break;default:l=a(b,"index")}this.state=this._checkState(c.extend({},g,{currentPage:l})),d.from=i,d.to=l;var m=(0===h?l:l-1)*k,n=f&&f.length?f.models.slice(m,m+k):[];return"client"!=e&&("infinite"!=e||c.isEmpty(n))||d.fetch?("infinite"==e&&(d.url=this.links[l]),this.fetch(c.omit(d,"fetch"))):(this.reset(n,c.omit(d,"fetch")),d.success(n,null,d),this)}});var e=d.Collection.prototype}(),d});
//# sourceMappingURL=backbone.hateoas.min.js.map